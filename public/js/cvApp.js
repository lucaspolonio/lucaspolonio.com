var app = angular.module('cvApp',[]);

app.controller('timelineController', ['$scope', function($scope){
  
  $scope.timeline_data = [
    //[name, [year, [months]*]*]*
    {
      name: 'Ruby on Rails',
      dates: [ [2013,[0,1,2,3,4,5,6,7,8,9,10,11]], [2014,[0,1,2,3,4,5,6,7,8]] ]
    },
    {
      name: 'Android',
      dates: [ [2011,[6,7,8,9,10,11]], [2012,[0,1,2,3,4,5,6,7,8,9,10,11]], [2013,[0,1,2,3,4,5,6]], [2014,[0,1,2,3,4,5]] ]
    },
    {
      name: 'iOS',
      dates: [ [2011,[6,7,8,9,10,11]], [2012,[0,1,2,3,4,5,6,7,8,9,10,11]], [2013,[0,1,2,3,4,5,6]], [2014,[0,1,2,3,4,5]] ]
    },
    {
      name: 'AngularJS',
      dates: [ [2013,[0,1,2,3,4,5,6,7,8,9,10,11]], [2014,[0,1,2,3,4,5,6,7,8]] ]
    },
    {
      name: 'js + jQuery',
      dates: [ [2004,[6,7,8,9,10,11]], [2005,[0,1,2,3,4,5,6,7,8,9,10,11]], [2006,[0,1,2,3,4,5,6,7,8,9,10,11]], [2009,[6,7,8,9,10,11]], [2010,[0,1,2,3,4,5,6,7,8,9,10,11]], [2011,[0,1,2,3,4,5,6,7,8,9,10,11]], [2012,[0,1,2,3,4,5,6,7,8,9,10,11]], [2013,[0,1,2,3,4,5,6,7,8,9,10,11]], [2014,[0,1,2,3,4,5,6,7,8]] ]
    },
    {
      name: 'PHP',
      dates: [ [2003,[5,6,7,8,9,10,11]], [2004,[0,1,2,3,4,5,6,7,8,9,10,11]], [2005,[0,1,2,3,4,5,6,7,8,9,10,11]],[2006,[0,1,2,3,4,5,6,7,8,9,10,11]], [2009,[6,7,8,9,10,11]], [2010,[0,1,2,3,4,5,6,7,8,9,10,11]], [2011,[0,1,2,3,4,5,6,7,8,9,10,11]], [2012,[0,1,2,3,4,5,6,7,8,9,10,11]], [2013,[0,1,2,3,4,5,6,7,8,9,10,11]], [2014,[0,1,2,3,4,5,6,7,8]] ]
    },
    {
      name: 'C/C++',
      dates: [ [2008,[0,1,2,3,4,5,6,7,8,9,10,11]],[2009,[0,1,2,3,4,5,6,7,8,9,10,11]], [2010,[0,1,2,3,4,5,6,7,8,9,10,11]], [2011,[0,1,2,3,4,5]] ]
    },
    {
      name: 'IT related',
      dates: [ [2003,[5,6,7,8,9,10,11]], [2004,[0,1,2,3,4,5,6,7,8,9,10,11]], [2005,[0,1,2,3,4,5,6,7,8,9,10,11]],[2006,[0,1,2,3,4,5,6,7,8,9,10,11]], [2007,[0,1,2,3,4,5,6,7,8,9,10,11]], [2008,[0,1,2,3,4,5,6,7,8,9,10,11]], [2009,[0,1,2,3,4,5,6,7,8,9,10,11]], , [2010,[0,1,2,3,4,5,6,7,8,9,10,11]], [2011,[0,1,2,3,4,5,6,7,8,9,10,11]], [2012,[0,1,2,3,4,5,6,7,8,9,10,11]], [2013,[0,1,2,3,4,5,6,7,8,9,10,11]], [2014,[0,1,2,3,4,5,6,7,8]] ]
    }
  ];

  $scope.init = function(){
    angular.forEach($scope.timeline_data, function(skill){
      skill['dates'] = $scope.format_skill_dates(skill['dates'])
    });
  }

  $scope.format_skill_dates = function(skill_dates){
    new_dates = [];
    for (y = 2003; y <= 2014; y++){
      months = $scope.months_by_year(skill_dates, y);
      new_dates[y] = [];
      for (m = 0; m < 12; m++){
        new_dates[y][m] = (months && months.indexOf(m) != -1)?1:0;
      };
    };
    new_dates = new_dates.filter(function() { return true; });
    return new_dates;
  };

  $scope.months_by_year = function(skill_dates, requested_year){
    var months = false
    angular.forEach(skill_dates, function(date){
      if (!months){
        year = date[0];
        if (year == requested_year){
          months = date[1];
        }
      }
    });
    return months;
  }

  $scope.init();
}]);